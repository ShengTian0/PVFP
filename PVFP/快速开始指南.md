# PVFP 快速开始指南

## 1. 环境准备（5分钟）

### Windows系统

```powershell
# 1. 创建虚拟环境
python -m venv pvfp_env

# 2. 激活环境
pvfp_env\Scripts\activate

# 3. 安装依赖（注意：TensorFlow 1.10需要Python 3.7）
pip install -r requirements.txt

# 4. 验证安装
python -c "import tensorflow as tf; print('TensorFlow版本:', tf.__version__)"
```

### Linux/Mac系统

```bash
# 1. 创建虚拟环境
python3.7 -m venv pvfp_env

# 2. 激活环境
source pvfp_env/bin/activate

# 3. 安装依赖
pip install -r requirements.txt

# 4. 验证安装
python -c "import tensorflow as tf; print('TensorFlow版本:', tf.__version__)"
```

## 2. 运行测试（验证安装，2分钟）

### 测试并行规则

```bash
python tests/test_parallel_rules.py
```

**预期输出：** 显示VNF并行规则测试结果，包括Rule1/2/3的验证。

### 测试SFC分解

```bash
python tests/test_decomposer.py
```

**预期输出：** 显示SFC分解过程和验证结果。

## 3. 运行快速演示（5分钟）

### 方式1: 直接运行主程序

```bash
python main.py
```

这将运行一个小规模实验：
- 12节点网络
- 4个域
- 10个SFC请求
- 20轮聚合

### 方式2: 运行预配置实验

**小规模实验：**
```bash
python experiments/run_small_scale.py
```

**大规模实验：**
```bash
python experiments/run_large_scale.py
```

## 4. 自定义实验（10分钟）

### 创建自定义实验脚本

```python
# my_experiment.py
from main import PVFPFramework

# 创建框架
pvfp = PVFPFramework(
    scale='small',      # 'small' 或 'large'
    num_domains=4       # 域的数量
)

# 运行训练
results = pvfp.run_federated_training(
    num_sfcs=15,           # SFC请求数
    aggregation_rounds=30  # 聚合轮数
)

# 评估模型
eval_results = pvfp.evaluate(num_sfcs=20)

# 打印统计
pvfp.aggregator.print_summary()
```

### 修改超参数

编辑 `config.py`：

```python
# DQN参数
LEARNING_RATE = 5e-4      # 学习率
BATCH_SIZE = 128          # 批次大小
GAMMA = 0.99              # 折扣因子

# 联邦学习参数
LAMBDA_STALENESS = 5      # 时滞衰减指数
DELTA_BASE = 0.9          # 基础聚合权重
AGGREGATION_EPOCHS = 100  # 聚合轮数
LOCAL_EPOCHS = 10         # 本地训练轮数
```

## 5. 查看结果（2分钟）

### 查看训练日志

训练过程中会实时显示：
- 各域训练进度
- 损失和奖励值
- 聚合信息

### 查看保存的结果

```bash
# 查看结果文件
ls logs/results/
```

结果文件格式：`pvfp_results_YYYYMMDD_HHMMSS.json`

### 可视化结果

```bash
python visualization/plot_results.py
```

这将生成：
- `loss_curve.png` - 损失曲线
- `reward_curve.png` - 奖励曲线
- `combined_metrics.png` - 组合指标图

图表保存在 `logs/plots/` 目录。

## 6. 常见问题解决

### Q1: 提示找不到模块

```
ModuleNotFoundError: No module named 'pvfp'
```

**解决：** 确保在项目根目录运行，即 `PVFP/` 目录下。

### Q2: TensorFlow版本不匹配

```
ERROR: Could not find a version that satisfies the requirement tensorflow-gpu==1.10.0
```

**解决：** 
1. 使用Python 3.7（TensorFlow 1.10不支持更高版本）
2. 或修改为使用TensorFlow 2.x（需要修改代码）

### Q3: GPU不可用

```python
# 检查GPU
import tensorflow as tf
print(tf.test.is_gpu_available())  # 应返回True
```

**如果返回False：**
- 安装CUDA 9.0和cuDNN 7.0（匹配TF 1.10）
- 或在 `config.py` 中设置 `USE_GPU = False` 使用CPU

### Q4: 内存不足

```
ResourceExhaustedError: OOM when allocating tensor
```

**解决：** 在 `config.py` 中减小：
```python
BATCH_SIZE = 64            # 从128减到64
REPLAY_BUFFER_SIZE = 64    # 从128减到64
GPU_MEMORY_FRACTION = 0.5  # 从0.8减到0.5
```

## 7. 实验建议

### 初次运行建议

1. **先运行测试**：确保所有模块正常工作
2. **小规模快速实验**：10个SFC，10轮聚合（约5分钟）
3. **查看结果**：确认训练过程正常
4. **逐步增加规模**：增加SFC数量和聚合轮数

### 完整实验配置

参考论文设置：

```python
# 小规模网络完整实验
pvfp = PVFPFramework(scale='small', num_domains=4)
results = pvfp.run_federated_training(
    num_sfcs=30,
    aggregation_rounds=100
)

# 重复30次独立实验（论文要求）
for i in range(30):
    pvfp = PVFPFramework(scale='small', num_domains=4)
    results = pvfp.run_federated_training(num_sfcs=30, aggregation_rounds=100)
    # 保存每次结果...
```

## 8. 下一步

- 📖 阅读 `README.md` 了解详细架构
- 🔬 运行完整实验获得论文级别结果
- 📊 使用可视化工具分析结果
- 🎯 与基线方法对比（需要自己实现基线）
- 📝 修改代码适应自己的研究需求

## 9. 获取帮助

- 查看代码注释（所有代码都有详细中文注释）
- 运行测试脚本理解各模块功能
- 参考论文原文理解算法细节

---

**祝实验顺利！** 🚀
